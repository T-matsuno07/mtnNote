# Git 戻す系操作一覧

# commit を取り消す git reset
gitは分散型システムなので，commitした後であってもpushするまでは他のメンバーに影響を与えることがなく，commit情報を削除したりまとめたりすることが出来る。  
使い方によっては，
- 最初に全機能の実装を行い，後から複数のcommitに分割する  
- 最初は細かくcommitしておき，後から一つのcommitに纏める

などが出来る。

原則として，pushした後は実施すべきではない。
他の人にも影響が出てしまうため。

# commit情報削除
`` git reset <mode> <commit> ``  
commitした情報を削除するコマンド。  
pull した際にマージが発生してしまったときに使うと良い。  
用途に応じて３つのどれかで歴史を巻き戻す。


### HEADだけを元に戻す (soft)
``git reset --soft HEAD~``  
最も影響の少ないオプションで，指定したコミットにHEADを変更(戻す)だけ。  
上記のコマンドだと，HEADを一つ前のコミットに戻す。
直近のcommit操作のみ取り消す効果であり，
addコマンドを実行した後の状態に戻る。  
無論，ファイルの変更状態は保持される。  
reset --soft HEAD~ → commit  
でコミットのログを書き直すことが出来る。

### HEADとインデックスを元に戻す (mixed or 未指定)
`` git reset --mixed HEAD~ ``  
HEADを指定したコミットに変更し，インデックスも指定したコミットの状態に戻す。HEADとインデックスを一つ目の状態に戻す効果がある。
直近のcommitとaddコマンドを取り消す効果があるため，commitした後に，ファイルの編集を追加してコミットしなおしたい時に使える。

インデックスの状態を元に戻す特徴を利用し，addコマンドを全取り消しするのに使える。    
`` git reset HEAD``  
このコマンドにより「add -u」などにより纏めてステージングしたファイルをインデックスから外すことが出来る。


### HEADとインデックス、ワーキングツリーを全て元に戻す (hard)
`` git reset --hard HEAD~ ``  
最もresetによる影響範囲が広いコマンドであり，
「コミット(commit)・ステージング(add)・ファイルの編集」を全て取り消す。一つ前のコミットの状態まで完全に戻すことが出来るコマンド。

非常に強力なコマンドであるが，ファイルの編集(ワーキングツリー)の内容まで削除するため，使用する際には最新の注意を払うこと。

ワーキングコピーでどんな変更を行ったかの全容が把握できなくなり，貯金のコミット状態までワーキングコピーを戻したいの場合には以下のコマンドを実行する。  
`` git reset --hard HEAD``  
このコマンドにより未commit情報は全て削除することが出来る。  
使い方を誤ると，自分が努力して作成したファイルが全てぶっ飛ぶ可能性があるため，使い時を見誤らないこと。

### 間違えた実施したresetを取り消す(ORIG_HEAD)

直前のresetを取り消したいのであれば，  
`` git reset --hard ORIG_HEAD ``  
を実施するとresetコマンドを取り消すことが出来る。  
ただし，復元できる情報はcommit済みの情報だけなので，--hard HEAD などにより，未コミットの情報を消してしまった場合は，復元することができないので注意すること。  

ORIG_HEADは，resetコマンドよって引き戻す前のHEAD状態を保存している領域(変数)

reset後色々いじってしまっていたら、慌てずに、git reflogコマンドを叩きましょう。

- git log：コミットの履歴を見る
- git reflog：これまでHEADが辿ってきた履歴を見る
- git reflogで戻したい状態を見つけ出し、

`` git reset [（必要なら）オプション] [ハッシュ値]``  
をすれば良い。
resetで困ったときは「reset＆reflog」と覚えておこう！
